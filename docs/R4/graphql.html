<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Graphql - FHIR v4.0.0</title>

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="author" content="http://hl7.org/fhir"/>

  <link rel="stylesheet" href="fhir.css"/>
  <link rel="Prev" href="http://hl7.org/fhir/graphql.html"/>

    <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="./dist/css/bootstrap.css"/>
  <link rel="stylesheet" href="./assets/css/bootstrap-fhir.css"/>

    <!-- Project extras -->
  <link rel="stylesheet" href="./assets/css/project.css"/>
  <link rel="stylesheet" href="./assets/css/pygments-manni.css"/>
	<link rel="stylesheet" href="jquery-ui.css"/>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- [if lt IE 9]>
  <script src="./assets/js/html5shiv.js"></script>
  <script src="./assets/js/respond.min.js"></script>
  <![endif] -->

    <!-- Favicons -->
  <link sizes="144x144" rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-144-precomposed.png"/>
  <link sizes="114x114" rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-114-precomposed.png"/>
  <link sizes="72x72" rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-72-precomposed.png"/>
  <link rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-57-precomposed.png"/>
  <link rel="shortcut icon" href="./assets/ico/favicon.png"/>

</head>
<body>
	<div id="segment-header" class="segment">  <!-- segment-header -->	
		<div class="container">  <!-- container -->
			<a no-external="true" id="logo" href="http://hl7.org/fhir"><img src="./assets/images/fhir-logo-www.png" alt="logo fhir"/> </a>
			<div id="hl7-status">
				<b>FHIR R4</b>
			</div>       	
			
			<div id="hl7-nav">
				 <a no-external="true" id="hl7-logo" href="http://www.hl7.org">
					<img src="./assets/images/hl7-logo.png" width="42" alt="visit the hl7 website" height="50"/>
				</a> 
			</div>       	
			<div id="hl7-nav"><a no-external="true" id="hl7-logo" href="http://hl7.org/fhir/search.cfm"><img src="./assets/images/search.png" alt="Search FHIR"/></a></div> 
		</div>
		<div class="container">  <!-- container -->
	</div></div>  <!-- /segment-header -->	


	<div id="segment-navbar" class="segment">  <!-- segment-navbar -->
		<div id="stripe"> </div>
		<div class="container">  <!-- container -->
   <!-- HEADER CONTENT -->
 	      		 	      		      		
			<nav class="navbar navbar-inverse">
				<div class="container">
					<button data-target=".navbar-inverse-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
						<span class="icon-bar"> </span>
						<span class="icon-bar"> </span>
						<span class="icon-bar"> </span>
					</button>
					<a href="index.html" class="navbar-brand hidden">FHIR</a>
					<div class="nav-collapse collapse navbar-inverse-collapse">
						<ul class="nav navbar-nav">
              <li><a href="./index.html">Home</a></li>
              <li><a href="./modules.html">Getting Started</a></li>
              <li><a href="./documentation.html">Documentation</a></li>
              <li><a href="./resourcelist.html">Resources</a></li>
              <li><a href="./profilelist.html">Profiles</a></li>
              <li><a href="./extensibility-registry.html">Extensions</a></li>
              <li><a href="./operationslist.html">Operations</a></li>
              <li><a href="./terminologies-systems.html">Terminologies</a></li>
						</ul>
					</div>  <!-- /.nav-collapse -->
				</div>  <!-- /.container -->
			</nav>  <!-- /.navbar -->
      		
  <!-- /HEADER CONTENT -->				
		</div>  <!-- /container -->
	</div>  <!-- /segment-navbar -->
	

	<div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
		<div class="container">  <!-- container -->	
			<ul class="breadcrumb">
        <li><a href="exchange-module.html"><img src="exchange.png"/> Exchange</a></li>
        <li><a href="http.html">RESTful API</a></li>
        <li><b>GraphQL</b></li>          <!-- graphql.html / page / -->

			</ul>	
		</div>  <!-- /container -->
	</div>  <!-- /segment-breadcrumb -->
	

	<div id="segment-content" class="segment">  <!-- segment-content -->
	<div class="container">  <!-- container -->
            <div class="row">
            	<div class="inner-wrapper">
  <!-- CONTENT CONTENT -->


<div class="col-12">

<a name="root"></a>
<h2 class="self-link-parent"><span class="sectioncount">3.1.2<a name="3.1.2"> </a></span> Using GraphQL with FHIR <a href="graphql.html#3.1.2" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h2>
<table class="colstu"><tr><td id="wg"><a href="http://www.hl7.org/Special/committees/fiwg/index.cfm" _target="blank">FHIR Infrastructure <img src="external.png" style="text-align: baseline"/></a> Work Group</td><td id="fmm"><a href="versions.html#maturity">Maturity Level</a>: 0</td><td id="ballot"><a href="versions.html#std-process">Standards Status</a>:  <!-- !ns! --><a href="versions.html#std-process">Trial Use</a></td></tr></table>
<p>
GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data.
This page describes how to use GraphQL with FHIR. The GraphQL interface may be implemented by
any server, and may be provided as a facade service in front of a conformant RESTful API. For GraphQL 
documentation, see <a href="http://graphql.org">http://graphql.org <img src="external.png" style="text-align: baseline"/></a>.
</p>
<blockquote><p> <b>Implementation Note:</b> 
This page is a draft. For ongoing discussion, see <a href="https://chat.fhir.org/#narrow/stream/implementers/subject/GraphQL">chat.fhir.org <img src="external.png" style="text-align: baseline"/></a>.
</p></blockquote>


<a name="status"></a>
<h3 class="self-link-parent"><span class="sectioncount">3.1.2.1</span> Status of GraphQL <a href="graphql.html#status" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h3>
<p>
Implementers should note that GraphQL is not a formal standard, and no standards path has been dscribed for it. 
At present, <a href="http://facebook.github.io/graphql/">GraphQL <img src="external.png" style="text-align: baseline"/></a> is copyright 
by <a href="http://facebook.com">Facebook <img src="external.png" style="text-align: baseline"/></a>, and licensed under a standard BSD-3 license. The GraphQL 
language is still under development.
</p>

<a name="invoking"></a>
<h3 class="self-link-parent"><span class="sectioncount">3.1.2.2</span> Invoking GraphQL <a href="graphql.html#invoking" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h3>
<p>
The standard end points for graphQL are as defined on the <a href="resource-operation-graphql.html">$graphql operation</a>:
</p>
<pre>
[base]/$graphql
</pre>
<p>
A System level query. The query must start by selecting a resource type and some search criteria, as defined <a href="#search">below</a>.
</p>
<pre>
[base]/[Type]/[id]/$graphql
</pre>
<p>
A Resource Instance level the query assumes a single resource is in scope, and just queries on the data available in the given resource.
</p>
<p>
GraphQL can be invoked by get with a query parameter, or a POST with the graphQL as the body, or a JSON body. (see <a href="http://graphql.org/learn/serving-over-http/">the GraphQL documentation <img src="external.png" style="text-align: baseline"/></a>). 
</p>
<p>
The mime type of the response is application/json. Other formats are not described by the specification. The mimetype is *not* application/fhir+json - the response is not a FHIR resource, though it may look like one closely.
</p>

<a name="conformance"></a>
<h3 class="self-link-parent"><span class="sectioncount">3.1.2.3</span> Conformance <a href="graphql.html#conformance" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h3>

<p>
Servers that conform to FHIR/GraphQL specification:
</p>
<ul>
 <li>SHALL use types, queries and mutations that conform to those provided in the GraphQL definitions in the specification</li>
 <li>SHOULD support the @skip and @include directives. The data re-organization directives defined at the end of this page SHOULD be considered too</li>
 <li>SHALL indicate in their conformance statement that they support graphQL queries (todo: how)</li>
 <li>SHOULD provide the same functionality as that defined in their conformance statement for read/search/create/update/delete/patch operations</li>
 <li>SHALL provide introspection services that correctly describe the services they offer</li>
 <li>MAY provide additional queries and mutations beyond those defined listed here</li>
</ul>

<p>
Note that most servers only provide a subset of the full functionality described by the FHIR interface. 
Where servers support FHIR features, and implement GraphQL, they must make them available as defined
by this page, but these rules do not require that servers implement all (or even any) of the functionality 
defined here. Also, these rules do not prevent servers providing additional end-points, queries or 
mutations that provide additional functionality. 
</p>

<a name="errors"></a>
<h4 class="self-link-parent"><span class="sectioncount">3.1.2.3.1</span> Error Handling <a href="graphql.html#errors" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h4>

<p>
With regard to handling errors, FHIR GraphQL servers:
</p>
<ul>
 <li>SHALL return a 200 ok with a "data" field, or a 3xx, 4xx or 5xx response with a graphQL error as described below</li>
 <li>SHALL return an error when fields that are not valid or not supported are used, or when queries, mutations, arguments, types, and directives that are not recognized or supported are encountered</li>
 <li>MAY include an operation outcome in a mutation response in the "extensions" property along with a "data" element, if the mutation succeeded. The OperationOutcome SHALL only include information and warning messages</li> 
</ul>

<p>
A graphQL error response with an <a href="operationoutcome.html">OperationOutcome</a> looks like this:
</p>
<pre class="json">
{
  "data": null,
  "errors": [
    {
      "extensions": {
        "resource" : {
          "resourceType": "OperationOutcome",
          "issue": [
            {
              "severity": "error",
              "code": "exception",
              "diagnostics": "500: Internal server error"
            }
          ]
        },
      },  
      "message": "500: Internal server error"
    }
  ]
}
</pre>
<p>
The error response SHALL include at least one error.
Each error SHALL include a <code>message</code>, and MAY include the graphQL <code>locations</code> and <code>path</code> properties. 
Each error SHOULD include an OperationOutcome in the <code>resource</code> property in the graphQL <code>extensions</code> element.
Note that in this usage, there MAY be multiple OperationOutcome, one for each <code>errors</code> item, with one issue matching the message. 
</p>

<a name="fields"></a>
<h3 class="self-link-parent"><span class="sectioncount">3.1.2.4</span> Field Selection <a href="graphql.html#fields" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h3>

<p>
Any FHIR defined field can be used directly e.g. this graphql against the Patient resource (r3)
</p>
<pre class="graphql">
 { 
  name { text given family } 
 }
</pre>
<p class="example">
Example: <a href="http://test.fhir.org/r3/Patient/example/$graphql?query={name{text,given,family}}">http://test.fhir.org/r3/Patient/example/$graphql?query={name{text,given,family}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
Polymorphic fields are represented by their JSON property name E.g. for Observation.value[x]:
</p>
<pre class="graphql">
 { 
  valueQuantity { value unit } 
 }
</pre>
<p class="example">
Example: <a href="http://test.fhir.org/r3/Observation/example/$graphql?query={valueQuantity{value,unit}}">http://test.fhir.org/r3/Observation/example/$graphql?query={valueQuantity{value,unit}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
Note: This is because the leaf names have to correspond to scalar types, so there is no use selecting all the variants at once 
</p>
<p>
Extensions on primitives: the JSON convention for primitives is observed. e.g. use _[name] for accessing extensions on primitives. So
</p>
<pre class="graphql">
 {
  birthDate _birthDate { extension {valueDateTime} } 
 }
</pre>
<p>
results in 
</p>
<pre class="json">
 {
  "birthDate":"2016-05-18",
  "_birthDate":{
    "extension":[{
      "valueDateTime":"2016-05-18T10:28:45Z"
     }]
  }
 }
</pre> 
<p class="example">
Example: <a href="http://test.fhir.org/r3/Patient/example/$graphql?query={birthDate,_birthDate{extension{valueDateTime}}}">http://test.fhir.org/r3/Patient/example/$graphql?query={birthDate,_birthDate{extension{valueDateTime}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>

<a name="arguments"></a>
<a name="list"></a>
<h4 class="self-link-parent"><span class="sectioncount">3.1.2.4.1</span> Field Arguments: List Navigation <a href="graphql.html#list" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h4>

<p>
Primitive fields SHALL NOT have any arguments at all. Complex fields may have one of more of the following parameters, all of which 
help select a subset of a repeating element:
</p>
<ul>
 <li><code>fhirpath</code> - a <a href="fhirpath.html">FHIRPath</a> statement selecting which of the subnodes is to be included</li>
 <li><code>[field]</code> - the name of a sub-property with a specified value that must be matched for the field to be included</li>
 <li><code>_offset</code> - specify the offset to start at for a repeating element (see below)</li>
 <li><code>_count</code> - specify how many to elements to return from a repeating list</li>
</ul>
 
<p><b>FHIRPath:</b></p> 
<p>
Use a <a href="fhirpath.html">FHIRPath</a> statement selecting which of the set of notes in a list is to be included:
</p>
<pre class="graphql">
 { 
  name(fhirpath: "family.exists()") { text given family } 
 }
</pre>
  <p class="example">  
  Example: <a href="http://test.fhir.org/r3/Patient/example/$graphql?query={name(fhirpath:%22family.exists()%22){text,given,family}}">http://test.fhir.org/r3/Patient/example/$graphql?query={name(fhirpath:%22family.exists()%22){text,given,family}} <img src="external.png" style="text-align: baseline"/></a> (as compared to <a href="http://test.fhir.org/r3/Patient/example/$graphql?query={name{text,given,family}}">http://test.fhir.org/r3/Patient/example/$graphql?query={name{text,given,family}} <img src="external.png" style="text-align: baseline"/></a>) (note: examples are only informative).
 </p>

<p><b>Field Filter:</b></p> 
<p>
Not all systems support FHIRPath, so a simpler syntax is provided, where the client
specifies a single sub-element by name, and a specified value that must be matched 
for the field to be included:
</p>
<pre class="graphql">
 { 
  name(use: official) { text given family } 
 }
</pre>
  <p class="example">
  Example: <a href="http://test.fhir.org/r3/Patient/example/$graphql?query={name(use:official){text,given,family}}">http://test.fhir.org/r3/Patient/example/$graphql?query={name(use:official){text,given,family}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
 </p>
 <p>
One way this can be used is to select particular extensions:
</p>
<pre class="graphql">
 { 
  myext: extension(url: "http://myextension.url/details") { value : valueString } 
 }
</pre>
<p>
will result in
</p>
<pre class="json">
 {
  "myext" : {
    "value" : "some value"
   }
 }
</pre>

<p><b>List offsets: _offset and _count</b></p> 
<p>
For some large resources, it may be desired to select only a subset of a long list of elements, and
to make repeated requests reading further into the list as long as required. This can be done with the 
<code>_count</code> and <code>offset</code> filters:
</p>
<pre class="graphql">
 { 
  entry(_count: 5, _offset: 5) { deleted item { reference } } 
 }
</pre>
  <p class="example">
  Example: <a href="http://test.fhir.org/r4/List/long/$graphql?query={entry(_count:5,_offset:5){deleted%20item{reference}}}">http://test.fhir.org/r4/List/long/$graphql?query={entry(_count:5,_offset:5){deleted item{reference}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
 </p>
<p>
This will select the second set of 5 entries in the nominated List resource. Clients can use this approach to iterate through a list. If 
a filter is applied to this (as documented above), the offset and count apply to the filtered list. Clients would iterate the list until
there are no more entries returned.
</p>

 
 
<a name="additional"></a>
<h4 class="self-link-parent"><span class="sectioncount">3.1.2.4.2</span> Additional Selectors <a href="graphql.html#additional" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h4>

<a name="references"></a>
<h5 class="self-link-parent"><span class="sectioncount">3.1.2.4.2.1</span> Resource references <a href="graphql.html#references" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h5>

<p>
An object of type <a href="references.html#Reference">Reference</a> can have an additional selection <code>resource</code>. This is an instruction to the server to resolve the reference, and then include the contents of the resource as specified by sub-selections in the property name "resource" (can be aliased). e.g. On Observation:
</p>
<pre class="graphql">
 { 
   subject { reference, resource {active} } 
 }
</pre>
<p>
The resource selector has two arguments: 
</p>
<ul>
<li><code>optional</code> : true | false. (default is false). If the server cannot resolve the reference (e.g. resource does not exist, or user security rights or choices do not permit resource to be seen), and optional is not true, the server returns an error instead of the graph output</li>
<li>type : [Resource] - only selects resources of a particular type, or ignores them if are they not of the right type. Note that this is similar in effect to 
<pre class="graphql">
 { 
  id
  subject { 
   reference
   resource {
      ...on Patient {
          birthDate
    }
    ...on Group {
        name
    }
   }
  }  
  code {coding {system code} }
 }
</pre>
</li>
</ul>
<p class="example">
Example: <a href="http://test.fhir.org/r4/Observation/example/$graphql?query={id,subject{reference,resource{...on%20Patient{birthDate}...on%20Practioner{practitionerRole{speciality}}}}code{coding{system,code}}}">http://test.fhir.org/r4/Observation/example/$graphql?query={id,subject{reference,resource{...on%20Patient{birthDate}...on%20Practioner{practitionerRole{speciality}}}}code{coding{system,code}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
but slightly denser:
</p>
<pre class="graphql">
 { 
  id
  subject { 
   reference
    resource(type : Patient) { birthDate }
    resource(type : Practioner) { practitionerRole {  speciality } }
  }  
  code {coding {system code} }
 }
 </pre>
<p class="example">
Example: <a href="http://test.fhir.org/r4/Observation/example/$graphql?query={id,subject{reference,resource(type:Patient){birthDate}resource(type:Practioner){practitionerRole{speciality}}}code{coding{system,code}}}">http://test.fhir.org/r4/Observation/example/$graphql?query={id,subject{reference,resource(type:Patient){birthDate}resource(type:Practioner){practitionerRole{speciality}}}code{coding{system,code}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
Clients can use either approach - type selection as a parameter, of using a fragment type condition - the first is shorter while the second aligns with the GraphQL schema more explicitly.
</p>

<a name="searching"></a>
<h3 class="self-link-parent"><span class="sectioncount">3.1.2.5</span> Searching resources <a href="graphql.html#searching" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h3>

<p>
When a GraphQL statement is run at the system level, rather than against a particular resource, 
the first thing the query must do is select the resource(s) of interest. The logic of this
follows the FHIR search API, but reimplements in a GraphQL centric way. 
</p>
<p>
There are 3 ways to query, for a single resource, for a simple list of resources, and a full API. 
For a single resource, the client names the type of the resource, and provides an id:
</p>
<pre class="graphql">
 { 
   Patient(id: example) { id, active } 
 }
</pre>
<p>
This returns a single Patient with the name id. The output from this is a single resource:
</p>
<pre class="json">
 {
   "data" : {
     "Patient" { 
       "id" : "example",
       "active" : "true",
     }
   }
 }
</pre>
<p class="example">
Example: <a href="http://test.fhir.org/r4/$graphql?query={Patient(id:example){id,name{given,family}}}">http://test.fhir.org/r4/$graphql?query={Patient(id:example){id,name{given,family}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
Alternatively, the client can ask for a list of resources.  Here, the client simply asks for a list of resources:
</p>
<pre class="graphql">
 { 
   ConditionList(clinical_status: relapse, patient: example) { id, clinicalStatus } 
 }
</pre>
<p>
This is a request to list all the Condition resources that have a status if 'relapsed' for the patient with id = example. The arguments are most of the search parameters defined on or for the specified resource. Notes:
</p>
<ul>
<li>the parameter's names are changed by replacing '-' in the name with '_' (for graphql syntax requirements) (FHIR defines parameters starting with _ but will never define search parameters starting with '-')</li>
<li>The search parameters _include, _revinclude, _contained, _containedType are not supported</li>
<li>Unlike the RESTful search API, the composite syntax (multiple arguments separated by comma) is not used. Instead, supply an array of parameters (_id: [1,2,example]). Values in an array or ORed</li>
<li>For And functionality, or to use chain searches or modifiers, use the _filter parameter</li>
<li>There is one additional possible argument, "fhirpath" which the server evaluates on all the possible matches</li>
</ul>

<p>
The output of this is a list:
</p>
<pre class="json">
 {
   "data" : {
     "ConditionList" : [{ 
       "id" : "100",
       "clinicalStatus" : "relapse"
     },{ 
       "id" : "100",
       "clinicalStatus" : "relapse"
     }]
   }
 }
</pre>
<p class="example">
Example: <a href="http://test.fhir.org/r4/$graphql?query={PatientList(name:%22pet%22){name{family,given}}}">http://test.fhir.org/r4/$graphql?query={PatientList(name:%22pet%22){name{family,given}}} <img src="external.png" style="text-align: baseline"/></a> 
(note: examples are only informative).
</p>
<p>
Servers may reject the request if there are too many matches to return in a single request. If they do so, they SHALL return an error indicating that the query could not be fulfilled. (rather than silently filtering the list).
</p>
<p>
The simple list approach does not allow for the management of long lists. To do this, clients are able to request a Connection based approach (based on <a href="http://graphql.org/learn/pagination/">http://graphql.org/learn/pagination/ <img src="external.png" style="text-align: baseline"/></a>, but adapted to the existing FHIR Search API). 
</p>
<pre class="graphql">
 { 
   ConditionConnection (clinical_status: active, patient: example) { 
     count offset pagesize
     edges {
       mode, score, resource { id, active }
     }
     first previous next last
   } 
 }
</pre>
<p>
The arguments are the same as for the simple List case, with the addition of the special argument 'cursor' (see below). The server returns a connection object that contains information about the search, along with a list of 'edges', one for each match. Each edge has 3 properties: mode, score (match the same properties on Bundle.entry.search) and "resource" which is the actual matches. 
</p>
<pre class="json">
 {
  "data" : {
    "ConditionConnection" : {
      "count": 50,
      "offset" : 0,
      "pageSize" : 25,
      "next" : "45f9ada8-db37-4498-ba7d-75a044668387:3"
      "edges" : [{
         "resource" : { 
           "id" : "100",
           "clinicalStatus" : "relapse",
         }
     },{ 
       "resource" : {
         "id" : "100",
         "clinicalStatus" : "relapse",
        }
     }]
   }
  }
 }
</pre>
<p>
Example 1: <a href="http://test.fhir.org/r4/$graphql?query={PatientConnection(name:%22pet%22){count,offset,pagesize,first,previous,next,last,edges{mode,score,resource{name{family,given}}}}}">http://test.fhir.org/r4/$graphql?query={PatientConnection(name:%22pet%22){count,offset,pagesize,first,previous,next,last,edges{mode,score,resource{name{family,given}}}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
Example 2 (cursor): <a href="http://test.fhir.org/r4/$graphql?query={PatientConnection(){count,offset,pagesize,first,previous,next,last,edges{mode,score,resource{resourceType,id,name{family,given}}}}}}}}">http://test.fhir.org/r4/$graphql?query={PatientConnection(){count,offset,pagesize,first,previous,next,last,edges{mode,score,resource{resourceType,id,name{family,given}}}}}}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
Notes: 
</p>
<ul>
<li>When using the fhirpath argument with Connection based searches, the server may choose to apply the fhirpath filter after the search paging is performed, so that individual pages may be shorter (or empty)</li>
</ul>

<p>
The client can follow up on the first/previous/next/last links using the argument 'cursor':
</p>
<pre class="graphql">
 { 
   ConditionConnection (_cursor : "45f9ada8-db37-4498-ba7d-75a044668387") { 
     count offset pagesize
     edges {
       id, clinicalStatus
     }
     first previous next last
   } 
 }
</pre>
<p class="example">
Example: <a href="http://test.fhir.org/r4/$graphql?query={PatientConnection(cursor:%225b0719b5-0f01-442e-9576-5b0514c19a:50%22){count,offset,pagesize,first,previous,next,last,edges{mode,score,resource{resourceType,id,name{family,given}}}}}}}}">http://test.fhir.org/r4/$graphql?query={PatientConnection(cursor:%225b0719b5-0f01-442e-9576-5b0514c19a:50%22){count,offset,pagesize,first,previous,next,last,edges{mode,score,resource{resourceType,id,name{family,given}}}}}}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative). (note, though, that to make this one work, you have to replace the cursor token with one that you got from the link above).
</p>

<p>
Notes:
</p>
<ul>
<li>The client cannot change the parameters for the search (and should not specify them) when providing a cursor. The value of the token is opaque to the client, and only understood by the server</li>
</ul>

<a name="list"></a>
<h5 class="self-link-parent"><span class="sectioncount">3.1.2.5.0.1</span> List vs Connection Searches <a href="graphql.html#list" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h5>

<p>
The specification defines the 2 forms of searches to meet differing requirements. For the List search:
</p>
<ul>
<li>the returned graph is simpler to iterate</li>
<li>in particular, the returned graph doesn't need to be considered with logic asking 'is there more pages to get' (the server returns everything, or an error)</li>
<li>servers can fulfill the simpler search with much less resources, because they do not need to remember state about the searches in order to correctly construct follow up pages</li>
</ul>
<p>
In general, clients should use the simple search, for efficiency purposes, where appropriate (e.g. where the user is not going see a 'next' button). This particularly applies when doing reverse reference resolution.
</p>

<a name="reverse"></a>
<h5 class="self-link-parent"><span class="sectioncount">3.1.2.5.0.2</span> Reverse References <a href="graphql.html#reverse" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h5>

<p>
It's also possible to use search is a special mode, doing reverse lookups - e.g. list all the resources that refer to this resource. 
An example of this use is to look up a patient, and also retrieve all the Condition resources for the patient. 
</p>
<p>
This is a special case of search, above, but with an additional mandatory parameter <code>_reference</code>. For example:
</p>
<pre class="graphql">
 {
   name { [some fields] }
   ConditionList(_reference: patient) {
    [some fields from Condition]
   }
 }
</pre>
<p>
There must be at least the argument "_reference" which identifies which of the search parameters for the target resource is used to match the resource that has focus. In addition, there may be other arguments as defined above in search (except that the "id" argument is prohibited here as nonsensical)
</p>
<p>
The response for the query above would be 
</p>
<pre class="json">
{
  "name: [ [some fields] ],
  "ConditionList" : [
    { [some fields from matching Condition resource] }
  ]
}
</pre>
<p class="example">
Example: <a href="http://test.fhir.org/r4/Patient/example/$graphql?query={name{family,given}ConditionList(_reference:patient){id,clinicalStatus}}">http://test.fhir.org/r4/Patient/example/$graphql?query={name{family,given}ConditionList(_reference:patient){id,clinicalStatus}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
The "connection" based search option is also supported, as described above, with the addition of _reference. If the client wishes to pursue any of the cursor based links in the graphQL results it asks for back, then it initiates this a new separate query as defined above, rather than repeating the nested query. I.e. the 'cursor' argument is prohibited, except at the root of query.
</p>
<p class="example">
Example: <a href="http://test.fhir.org/r4/Patient/example/$graphql?query={name{family,given}ConditionConnection(_reference:patient){count,offset,pagesize,first,previous,next,last,edges{mode,score,resource{...onCondition{resourceType,id,clinicalStatus}}}}}">http://test.fhir.org/r4/Patient/example/$graphql?query={name{family,given}ConditionConnection(_reference:patient){count,offset,pagesize,first,previous,next,last,edges{mode,score,resource{...onCondition{resourceType,id,clinicalStatus}}}}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>

<a name="operations"></a>
<h3 class="self-link-parent"><span class="sectioncount">3.1.2.6</span> Operations <a href="graphql.html#operations" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h3>

<p>
It's also possible to apply graphql to the results of other operations. This is done by adding the parameter "_graphql" when invoking the operation. e.g.
</p>
<pre>
  GET [base]/ValueSet/doc-typecodes/$validate-code?system=http://loinc.org&amp;code=1963-8&amp;display=test&amp;_graphql={result:parameter(name:"result"){value:valueBoolean}}
</pre>
<p class="example">
Example: <a href="http://test.fhir.org/r4/ValueSet/doc-typecodes/$validate-code?system=http://loinc.org&amp;code=1963-8&amp;display=test&amp;_graphql={result:parameter(name:%22result%22){value:valueBoolean}}">http://test.fhir.org/r4/ValueSet/doc-typecodes/$validate-code?system=http://loinc.org&amp;code=1963-8&amp;display=test&amp;_graphql={result:parameter(name:%22result%22){value:valueBoolean}} <img src="external.png" style="text-align: baseline"/></a> (note: examples are only informative).
</p>
<p>
The graphQL is executed on the output of the operation. If the operation fails, and returns an operation outcome, then the graphQL is not executed.
</p>

<a name="flattening"></a>
<h3 class="self-link-parent"><span class="sectioncount">3.1.2.7</span> Data Flattening Directives <a href="graphql.html#flattening" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h3>

<p>
GraphQL is a very effective language for navigating a graph and selecting subset of information from it. However 
for some uses, the physical structure of the result set is important. This is most relevant when extracting data 
for statistical analysis in languages such as <a href="https://www.r-project.org/">R <img src="external.png" style="text-align: baseline"/></a>. In order to facilitate 
these kind of uses, FHIR servers should consider supporting the following directives that allow implementers to 
flatten the return graph for easier analysis
</p>

<h4 class="self-link-parent"><span class="sectioncount">3.1.2.7.1<a name="3.1.2.7.1"> </a></span> Flattening a node <a href="graphql.html#3.1.2.7.1" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h4>
<pre>
@flatten
</pre>
<p>
This directive indicates that the field to which it is attached is not actually produced in the output graph. 
Instead, its children will be processed and added to the output graph as specified in its place.
</p>
<p>
Notes:
</p>
<ul>
 <li>If @flatten is used on an element with repeating cardinality, then by default, all the children will become lists</li>
 <li>When using @flatten, all the collated children must have the same FHIR type. The server SHALL return an error if they don't</li>
</ul>
<p>
For an example, take this graphQL, and apply it to the patient example:
</p>
<pre class="graphql">
{
  identifier { system value }
  active 
  name { text given family } 
}
</pre>
<p>
This will give the output:
</p>
<pre class="json">
{
  "identifier": [{
      "system": "urn:oid:1.2.36.146.595.217.0.1",
      "value": "12345"
  }],
  "active": true,
  "name": [{
    "given": ["Peter","James"],
    "family": "Chalmers"
  },{
    "given": ["Jim"]
  },{
    "given": ["Peter","James"],
    "family": "Windsor"
  }]
}
</pre>
<p>
Adding the <code>@flatten</code> directive changes the output:
</p>
<pre class="graphql">
{
  identifier @flatten { system value }
  active 
  name @flatten { text given family } 
}
</pre>
<p>
This has the output:
</p>
<pre class="json">
{
  "system":["urn:oid:1.2.36.146.595.217.0.1"],
  "value":["12345"],
  "active":true,
  "given":["Peter","James","Jim","Peter","James"],
  "family":["Chalmers","Windsor"]
}</pre>

<h4 class="self-link-parent"><span class="sectioncount">3.1.2.7.2<a name="3.1.2.7.2"> </a></span> Short cut for selecting only the first element <a href="graphql.html#3.1.2.7.2" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h4>
<pre>
@first
</pre>
<p>
This is a shortcut for a FHIR path filter [$index = 0] and indicates to only take the first match of 
the elements. Note that the selection of the first element only applies to the immediate context of 
the field in the source graph, not to the output graph
</p>
<p>
Example:
</p>
<pre class="graphql">
{
  identifier @flatten { system value }
  active 
  name @flatten { text given @first family } 
}
</pre>
<p>
Gives the output:
</p>
<pre class="json">
{
  "system":["urn:oid:1.2.36.146.595.217.0.1"],
  "value":["12345"],
  "active":true,
  "given":["Peter","Jim","Peter"],
  "family":["Chalmers","Windsor"]
}
</pre>

<h4 class="self-link-parent"><span class="sectioncount">3.1.2.7.3<a name="3.1.2.7.3"> </a></span> Managing output cardinality <a href="graphql.html#3.1.2.7.3" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h4>
<pre>
@singleton
</pre>
<p>
This directive indicates that an field collates to a single node, not a list. It is only used in association 
with fields on which a parent has <code>@flatten</code>, and overrides the impact of flattening the parent in 
making it a list. The server SHALL return an error if there is more than one value when flattening
</p>
<p>
Extending the previous example, adding <code>@singleton</code>:
</p>
<pre class="graphql">
{
  identifier @flatten { system @singleton value @singleton }
  active 
  name @flatten @first { text given family @singleton } 
}
</pre>
<p>
Gives the output:
</p>
<pre class="json">
{
  "system":"urn:oid:1.2.36.146.595.217.0.1",
  "value":"12345",
  "active":true,
  "given":["Peter","James"],
  "family":"Chalmers"
}
</pre>

<h4 class="self-link-parent"><span class="sectioncount">3.1.2.7.4<a name="3.1.2.7.4"> </a></span> Converting Lists to singletons <a href="graphql.html#3.1.2.7.4" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h4>

<pre>
@slice(fhirpath)
</pre>
<p>
This indicates that in the output graph, each element in the source will have "." and the result of 
the FHIRPath as a string appended to the specified name. This slices a list up into multiple single 
values. For example
</p>
<pre class="graphql">
{ name @slice(path: "$index") @flatten {given @first @singleton family}}
</pre>
<p>
For a resource that has 2 names will result in the output
</p>
<pre class="json">
{
"Given.0" : "first name, first given",
"Family.0" : ["first name family name"],
"Given.1" : "second name, first given",
"Family.1" : ["second name family name"]
}
</pre>
<p>
Other uses might be e.g. Telecom @slice(use) to generate telecom.home for instance.
</p>
<p>
Notes:
</p>
<ul>
 <li>In general, the intent of @slice is to break a list into multiple singletons. However 
  servers SHALL NOT treat the outputs as singletons unless this is explicitly specified using <code>@singleton</code></li>
 <li>The suffixes added by this method are cumulative when nesting e.g. .suffix1.suffix2</li>
 <li>The same general outcome can be achieved by a set of fields, each with an alias 
   and a filter, if the possible values are known in advance</li>
</ul>
<p>
Examples:
</p>

<pre class="graphql">
{
  identifier @flatten { system value }
  active 
  name @flatten @slice(path: "use") { given family @singleton } 
}
</pre>
<p> produces </p>
<pre class="json">
{
  "system":["urn:oid:1.2.36.146.595.217.0.1"],
  "value":["12345"],
  "active":true,
  "given.official":["Peter","James"],
  "family.official":"Chalmers",
  "given.usual":["Jim"],
  "given.maiden":["Peter","James"],
  "family.maiden":"Windsor"
}
</pre>

<p>and</p>
<pre class="graphql">
{
  identifier @flatten { system value }
  active 
  name @flatten @slice(path: "$index") { given family @singleton } 
}
</pre>
<p> produces </p>
<pre class="json">
{
  "system":["urn:oid:1.2.36.146.595.217.0.1"],
  "value":["12345"],
  "active":true,
  "given.0":["Peter","James"],
  "family.0":"Chalmers",
  "given.1":["Jim"],
  "given.2":["Peter","James"],
  "family.2":"Windsor"
}
</pre>


<a name="mutations"></a>
<h3 class="self-link-parent"><span class="sectioncount">3.1.2.8</span> Mutations <a href="graphql.html#mutations" title="link to here" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h3>

<p>
Mutations are defined for the operations Create, Update, and Delete. 
</p>
<p>
Create:
</p>
<pre class="graphql">
 PatientCreate(res : Patient) {
   returns a Patient 
 }
</pre>
<p>
Like the API, the Patient resource might or might not have an ID; if it is present, the value is overwritten by the server.
</p>
<p>
Update:
</p>
<pre class="graphql">
 PatientUpdate(id : ID, res : Patient) {
   returns a Patient 
 }
</pre>
<p>
Delete:
</p>
<pre class="graphql">
 PatientDelete(id : ID) {
   [no return]
 }
</pre>
<p>
The parameters are input types that are resources that exactly match the output types. If these operations fail, an http error is returned.
</p>
<p>
Todo: mutations for patch, batch, transaction?
</p>

</div>


				</div>  <!-- /inner-wrapper -->
            </div>  <!-- /row -->
        </div>  <!-- /container -->
        
    </div>  <!-- /segment-content -->


	<div id="segment-footer" class="segment">  <!-- segment-footer -->
		<div class="container">  <!-- container -->
			<div class="inner-wrapper">
				<p>
        &reg;&copy; HL7.org 2011+. FHIR Release 4 (v4.0.0) generated on Thu, Dec 27, 2018. <a style="color: #ffffff" href="qa.html">QA Page</a>
        <br/>
        <span style="color: #FFFF77">
        Links: <a style="color: #b8dcf9" href="http://hl7.org/fhir/search.cfm">Search <img src="external.png" style="text-align: baseline"/></a> | 
               <a style="color: #b8dcf9" href="history.html">Version History</a> | 
               <a style="color: #b8dcf9" href="toc.html">Table of Contents</a> | 
               <a style="color: #b8dcf9" href="credits.html">Credits</a> | 
               <a style="color: #b8dcf9" href="http://services.w3.org/htmldiff?doc1=http%3A%2F%2Fhl7.org%2Ffhir%2FSTU3%2Fgraphql.html&amp;doc2=http%3A%2F%2Fhl7.org%2Ffhir%2FR4%2Fgraphql.html">Compare to R3 <img src="external.png" style="text-align: baseline"/></a> |                
               <a rel="license" style="color: #b8dcf9" href="license.html"><img src="cc0.png" alt="CC0" style="border-style: none;"/></a> | 
               <a style="color: #b8dcf9" href="http://hl7.org/fhir-issues" target="_blank">Propose a change <img src="external.png" style="text-align: baseline"/></a>   
        </span>
        </p>
			</div>  <!-- /inner-wrapper -->
		</div>  <!-- /container -->
	</div>  <!-- /segment-footer -->
  <!-- disqus thread -->
  <!-- disqus -->
  <!-- end disqus -->        
	
	<div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
		<div class="container">  <!-- container -->
		</div>  <!-- /container -->
	</div>  <!-- /segment-post-footer -->
    
      <!-- JS and analytics only. -->
      <!-- Bootstrap core JavaScript
================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
<script src="./assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
<script src="./dist/js/bootstrap.min.js"> </script>
<script src="./assets/js/respond.min.js"> </script>

<script src="./assets/js/fhir.js"> </script>

  <!-- Analytics Below
================================================== -->

</body>
</html>