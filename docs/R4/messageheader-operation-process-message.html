<!DOCTYPE HTML>
  <!-- template-operations.html --><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
    <title>操作-消息处理 - HL7 FHIR 中国</title>

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="author" content="http://hl7.org/fhir"/>

  <link rel="stylesheet" href="fhir.css"/>
  <link rel="Prev" href="http://hl7.org/fhir/something"/>

    <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="./dist/css/bootstrap.css"/>
  <link rel="stylesheet" href="./assets/css/bootstrap-fhir.css"/>

    <!-- Project extras -->
  <link rel="stylesheet" href="./assets/css/project.css"/>
  <link rel="stylesheet" href="./assets/css/pygments-manni.css"/>
	<link rel="stylesheet" href="jquery-ui.css"/>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- [if lt IE 9]>
  <script src="./assets/js/html5shiv.js"></script>
  <script src="./assets/js/respond.min.js"></script>
  <![endif] -->

    <!-- Favicons -->
  <link sizes="144x144" rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-144-precomposed.png"/>
  <link sizes="114x114" rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-114-precomposed.png"/>
  <link sizes="72x72" rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-72-precomposed.png"/>
  <link rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-57-precomposed.png"/>
  <link rel="shortcut icon" href="./assets/ico/favicon.png"/>

</head>
<body>
	    <div id="segment-header" class="segment"></div>  <!-- /segment-header -->	


	<div id="segment-navbar" class="segment">  <!-- segment-navbar -->
		<div id="stripe"> </div>
		<div class="container">  <!-- container -->
   <!-- HEADER CONTENT -->
 	      		 	      		      		
			<nav class="navbar navbar-inverse">
				<div class="container">
					<button data-target=".navbar-inverse-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
						<span class="icon-bar"> </span>
						<span class="icon-bar"> </span>
						<span class="icon-bar"> </span>
					</button>
					<a href="index.html" class="navbar-brand hidden">FHIR</a>
					    <div class="nav-collapse collapse navbar-inverse-collapse"  id="nav-content"></div>  <!-- /.nav-collapse -->
				</div>  <!-- /.container -->
			</nav>  <!-- /.navbar -->
      		
  <!-- /HEADER CONTENT -->				
		</div>  <!-- /container -->
	</div>  <!-- /segment-navbar -->
	

	<div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
		<div class="container">  <!-- container -->	
			<ul class="breadcrumb">
        <li><img src="foundation.png"/><b> 当前位置：</b><a href="foundation-module.html"> 基础</a></li>        <li><a href="messageheader.html">消息头</a></li>        
        <li>操作</li>          <!-- messageheader.html / res-Operations / Operation Definition -->

			</ul>	
		</div>  <!-- /container -->
	</div>  <!-- /segment-breadcrumb -->
	

	<div id="segment-content" class="segment">  <!-- segment-content -->
	<div class="container">  <!-- container -->
            <div class="row">
            	<div class="inner-wrapper">
  <!-- CONTENT CONTENT -->


<div class="col-12">

<ul class="nav nav-tabs"><li><a href="messageheader.html">Content</a></li><li><a href="messageheader-examples.html">Examples</a></li><li><a href="messageheader-definitions.html">Detailed Descriptions</a></li><li><a href="messageheader-mappings.html">Mappings</a></li><li><a href="messageheader-profiles.html">Profiles &amp; Extensions</a></li><li><a href="messageheader-operations.html">Operations</a></li><li><a href="messageheader-version-maps.html">R3 Conversions</a></li></ul>

<h3 class="self-link-parent">
    <span class="sectioncount">2.47.9.1<a name="2.47.9.1"> </a></span>
    对消息头的消息处理操作（$process-message）
    <a href="messageheader-operation-process-message.html#2.47.9.1" title="此处链接地址" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a>
</h3>

<table class="colstu"><tr><td>工作组:<a href="http://www.hl7.org/special/committees/inm/index.cfm">Infrastructure And Messaging <img src="external.png" style="text-align: baseline"/></a></td><td>&nbsp;<a href="versions.html#maturity" title="Maturity Level">成熟度</a>: 4</td><td><a href="versions.html#std-process">试用</a></td>  <!-- !ns! --><td><a href="compartmentdefinition.html">隔间</a>: N/A</td></tr></table>



<p>
    此操作用来接收消息，根据消息头中的事件定义对其进行处理，并返回一条或多条响应消息。
  
</p>
<p>
    除了处理消息事件之外，服务器还可以选择保留所有或部分资源，并使它们在RESTful接口上可用，但没要求这样做。

</p>

<p>The official URL for this operation definition is</p>
<pre> http://hl7.org/fhir/OperationDefinition/MessageHeader-process-message</pre>
<p><a href="operation-messageheader-process-message.html">Formal Definition</a> (as a <a href="operationdefinition.html">OperationDefinition</a>).</p>
<p>URL: [base]/$process-message</p>
<p>This is <b>not</b> an idempotent operation</p>
<table class="grid">
<tr><td colspan="6"><b>In Parameters:</b></td></tr>
<tr><td><b>Name</b></td><td><b>Cardinality</b></td><td><b>Type</b></td><td><b>Binding</b></td><td><b>Profile</b></td><td><b>Documentation</b></td></tr><tr><td>content</td><td>1..1</td><td><a href="bundle.html">Bundle</a></td><td></td><td></td><td><p>The message to process (or, if using asynchronous messaging, it may be a response message to accept)</p>
</td></tr><tr><td>async</td><td>0..1</td><td><a href="datatypes.html#boolean">boolean</a></td><td></td><td></td><td><p>If 'true' the message is processed using the asynchronous messaging pattern</p>
</td></tr><tr><td>response-url</td><td>0..1</td><td><a href="datatypes.html#url">url</a></td><td></td><td></td><td><p>A URL to submit response messages to, if asynchronous messaging is being used, and if the MessageHeader.source.endpoint is not the appropriate place to submit responses</p>
</td></tr><tr><td colspan="6"><b>Out Parameters:</b></td></tr>
<tr><td><b>Name</b></td><td><b>Cardinality</b></td><td><b>Type</b></td><td><b>Binding</b></td><td><b>Profile</b></td><td><b>Documentation</b></td></tr><tr><td>return</td><td>0..1</td><td><a href="bundle.html">Bundle</a></td><td></td><td></td><td><p>A response message, if synchronous messaging is being used (mandatory in this case). For asynchronous messaging, there is no return value</p>
<p>Note: as this is the only out parameter, it is a resource, and it has the name 'return', the result of this operation is returned directly as a resource</p></td></tr></table>
<p>This operation does not use the parameters resource; the parameters "async" and "response-url" always go in the URL, if they are used, and the "content" parameter is always the body of the HTTP message.</p>
<p>When processing messages, a server may return one of several status codes:</p>
<ul>
<li><strong>200 OK</strong>: Indicates that the message has been fully processed.  If an application-level response is expected for the submitted message, that response SHALL be returned as the body of the 200 response.</li>
<li><strong>202 Accepted</strong>: Indicates that the receiving system has accepted custody of the message</li>
<li><strong>204 No Content</strong>: Indicates that the message has been fully processed and would normally have had an application-level response, but because of instructions from the sender (e.g. the <a href="extension-messageheader-response-request.html">messageheader-response-request</a> extension), no response is being provided</li>
<li><strong>300+</strong>: Indicates that the message was not successfully processed.  The server MAY return an <a href="operationoutcome.html">OperationOutcome</a> with additional information, and SHOULD do so if the response code is 400 or greater.
<br />
The client SHALL interpret a 4xx response to indicate that there is no point resubmitting the unaltered message, and a 5xx response to indicate an unexpected error occurred on the part of the server, with the implication that it may be appropriate to resubmit the original message. Doing so SHOULD NOT result in a duplicate message response. Repeated failures indicate either a fatal problem with the submission or a problem with the receiving application.</li>
</ul>
<p>The following rules apply when using $process-message:</p>
<ul>
<li>The operation only accepts POST transactions - any other HTTP method will result in an HTTP error</li>
<li>The request content type submitted is always <a href="bundle.html">Bundle</a> with type "message" containing a <a href="messageheader.html">Message Header</a> resource as the first resource</li>
<li>The response content type returned is always <a href="bundle.html">Bundle</a> with type "message" containing a <a href="messageheader.html">Message Header</a> resource as the first resource, or an HTTP error</li>
<li>If the response is an error, the body SHOULD be an <a href="operationoutcome.html">Errors &amp;mp; Warning</a> resource with full details</li>
<li>The mailbox may be authenticated using standard HTTP authentication methods, including OAuth</li>
</ul>
<p>The $process-message operation can be used by any HTTP end-point that accepts FHIR messages, not just FHIR RESTful servers.</p>
<p>In order to ensure consistency of processing, the <a href="messaging.html#reliable">logical rules regarding processing of Bundle.id and message id</a> SHALL be followed when messages are processed using this operation.</p>
<p>The $process-message operation may be used synchronously, or asynchronously.</p>
<p>The following rules apply when using the $process-message operation synchronously:</p>
<ul>
<li>The URL (http://server/base/$process-message) has no parameters</li>
<li>It is an error if the sender POSTs a message that requires multiple response messages</li>
<li>Servers SHALL accept multiple concurrent message submissions and process them correctly (they are allowed to process them sequentially internally, but multiple concurrent submissions is not an error in its own right)</li>
</ul>
<p>The following rules apply when using the $process-message operation asynchronously:</p>
<ul>
<li>The URL has at least one parameter: http://server/base/$process-message?async=true</li>
<li>The server acknowledges the message with a 200 OK with no body, or returns an HTTP error if the message cannot be processed</li>
<li>Accepting the message means that the server has understood the message enough to know where to respond</li>
<li>An <a href="operationoutcome.html">OperationOutcome</a> SHOULD be returned in either case</li>
<li>By default, the server responds by invoking the $process-message using the sender's stated end-point in the message: POST [MessageHeader.source.endpoint]/$process-messages]</li>
<li>Since the source end-point may be manipulated by message transfer engines, an alternative response address may be specified using the parameter "response-url": http://server/base/$process-message?async=true&amp;amp;response-url=http://server2.com/base/anything.  The endpoint at the specified URL SHALL implement the signature of the $process-message operation (parameter async=true, accept a Bundle, return a 200 OK or an error)</li>
<li>The server submits response messages to the appropriate end-point with the parameter async=true. There is no response message for the response messages</li>
</ul>

<a name="examples"> </a>
<h4 class="self-link-parent"><span class="sectioncount">2.47.9.1.1</span> Examples <a href="messageheader-operation-process-message.html#examples" title="此处链接地址" class="self-link"><svg viewBox="0 0 1792 1792" width="20" class="self-link" height="20"><path d="M1520 1216q0-40-28-68l-208-208q-28-28-68-28-42 0-72 32 3 3 19 18.5t21.5 21.5 15 19 13 25.5 3.5 27.5q0 40-28 68t-68 28q-15 0-27.5-3.5t-25.5-13-19-15-21.5-21.5-18.5-19q-33 31-33 73 0 40 28 68l206 207q27 27 68 27 40 0 68-26l147-146q28-28 28-67zm-703-705q0-40-28-68l-206-207q-28-28-68-28-39 0-68 27l-147 146q-28 28-28 67 0 40 28 68l208 208q27 27 68 27 42 0 72-31-3-3-19-18.5t-21.5-21.5-15-19-13-25.5-3.5-27.5q0-40 28-68t68-28q15 0 27.5 3.5t25.5 13 19 15 21.5 21.5 18.5 19q33-31 33-73zm895 705q0 120-85 203l-147 146q-83 83-203 83-121 0-204-85l-206-207q-83-83-83-203 0-123 88-209l-88-88q-86 88-208 88-120 0-204-84l-208-208q-84-84-84-204t85-203l147-146q83-83 203-83 121 0 204 85l206 207q83 83 83 203 0 123-88 209l88 88q86-88 208-88 120 0 204 84l208 208q84 84 84 204z" fill="navy"></path></svg></a></h4>
<p><p>Request: Request to link 2 patients, and respond asynchronously</p>
</p>
<pre>
POST /ehr/fhir/$process-message?aync=true&amp;response-url=http://example.org/clients/ehr-lite
[other headers]

&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;Bundle xmlns="http://hl7.org/fhir"&gt;
  &lt;id value="10bb101f-a121-4264-a920-67be9cb82c74"/&gt;
  &lt;type value="message"/&gt;
  &lt;timestamp value="2015-07-14T11:15:33+10:00"/&gt;
  &lt;entry&gt;
    &lt;fullUrl value="urn:uuid:267b18ce-3d37-4581-9baa-6fada338038b"/&gt;
    &lt;resource&gt;
      &lt;MessageHeader&gt;
        &lt;!-- 
          Note about the id: according to the spec, the fullUrl must not 
          disagree with the id in the resource. For instance, if the fullUrl 
          was http://server/path/MessageHeader/267b18ce-3d37-4581-9baa-6fada338038b,
          then the id of the resource must be 267b18ce-3d37-4581-9baa-6fada338038b.
          
          However, in this case, a fullUrl of urn:uuid:[x] makes no claim about
          the id of the resource, and it can be different, or missing. Note, though
          that this doesn't really make sense; if it's present, there's less 
          potential for confusion if they match, like in this case
        --&gt;
        &lt;id value="267b18ce-3d37-4581-9baa-6fada338038b"/&gt;
        &lt;text&gt;
          &lt;status value="generated"/&gt;
          &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
             
            &lt;p&gt;This message is a request to link Patient records 654321 (Patient Donald DUCK @ Acme Healthcare, Inc) and 123456 (Patient Donald D DUCK @ Acme Healthcare, Inc)&lt;/p&gt;
           
          &lt;/div&gt;
        &lt;/text&gt;
        &lt;eventCoding&gt;
          &lt;system value="http://example.org/fhir/message-events"/&gt;
          &lt;code value="patient-link"/&gt;
        &lt;/eventCoding&gt;    
        &lt;source&gt;
          &lt;endpoint value="http://example.org/clients/ehr-lite"/&gt;
        &lt;/source&gt;
        &lt;responsible&gt;
          &lt;reference value="http://acme.com/ehr/fhir/Practitioner/2323-33-4"/&gt;
        &lt;/responsible&gt;
      &lt;!--  this message is posted to http://acme.com/ehr/fhir, 
             with an event 'link' to link 2 patient records, and nominates
             2 patients on the server  --&gt;
        &lt;focus&gt;
          &lt;reference value="http://acme.com/ehr/fhir/Patient/pat1"/&gt;
        &lt;/focus&gt;
        &lt;focus&gt;
          &lt;reference value="http://acme.com/ehr/fhir/Patient/pat12"/&gt;
        &lt;/focus&gt;
      &lt;/MessageHeader&gt;
    &lt;/resource&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;fullUrl value="http://acme.com/ehr/fhir/Patient/pat1"/&gt;
    &lt;resource&gt;
      &lt;Patient&gt;
        &lt;id value="pat1"/&gt;
        &lt;text&gt;
          &lt;status value="generated"/&gt;
          &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
            
            &lt;p&gt;Patient Donald DUCK @ Acme Healthcare, Inc. MR = 654321&lt;/p&gt;
          
          &lt;/div&gt;
        &lt;/text&gt;
        &lt;identifier&gt;
          &lt;use value="usual"/&gt;
          &lt;type&gt;
            &lt;coding&gt;
              &lt;system value="http://terminology.hl7.org/CodeSystem/v2-0203"/&gt;
              &lt;code value="MR"/&gt;
            &lt;/coding&gt;
          &lt;/type&gt;
          &lt;system value="urn:oid:0.1.2.3.4.5.6.7"/&gt;
          &lt;value value="654321"/&gt;
        &lt;/identifier&gt;
        &lt;active value="true"/&gt;
        &lt;name&gt;
          &lt;use value="official"/&gt;
          &lt;family value="Donald"/&gt;
          &lt;given value="Duck"/&gt;
        &lt;/name&gt;
        &lt;gender value="male"/&gt;
        &lt;contact&gt;
          &lt;relationship&gt;
            &lt;coding&gt;
              &lt;system value="http://example.org/fhir/CodeSystem/patient-contact-relationship"/&gt;
              &lt;code value="E"/&gt;
            &lt;/coding&gt;
          &lt;/relationship&gt;
          &lt;organization&gt;
            &lt;reference value="Organization/1"/&gt;
            &lt;display value="Walt Disney Corporation"/&gt;
          &lt;/organization&gt;
        &lt;/contact&gt;
        &lt;managingOrganization&gt;
          &lt;reference value="Organization/1"/&gt;
          &lt;display value="ACME Healthcare, Inc"/&gt;
        &lt;/managingOrganization&gt;
      &lt;/Patient&gt;
    &lt;/resource&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;fullUrl value="http://acme.com/ehr/fhir/Patient/pat12"/&gt;
    &lt;resource&gt;
      &lt;Patient&gt;
        &lt;id value="pat2"/&gt;
        &lt;text&gt;
          &lt;status value="generated"/&gt;
          &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
            
            &lt;p&gt;Patient Donald D DUCK @ Acme Healthcare, Inc. MR = 123456&lt;/p&gt;
          
          &lt;/div&gt;
        &lt;/text&gt;
        &lt;identifier&gt;
          &lt;use value="usual"/&gt;
          &lt;type&gt;
            &lt;coding&gt;
              &lt;system value="http://terminology.hl7.org/CodeSystem/v2-0203"/&gt;
              &lt;code value="MR"/&gt;
            &lt;/coding&gt;
          &lt;/type&gt;
          &lt;system value="urn:oid:0.1.2.3.4.5.6.7"/&gt;
          &lt;value value="123456"/&gt;
        &lt;/identifier&gt;
        &lt;active value="true"/&gt;
        &lt;name&gt;
          &lt;use value="official"/&gt;
          &lt;family value="Donald"/&gt;
          &lt;given value="Duck"/&gt;
          &lt;given value="D"/&gt;
        &lt;/name&gt;
        &lt;gender value="other"&gt;
          &lt;extension url="http://example.org/Profile/administrative-status"&gt;
            &lt;valueCodeableConcept&gt;
              &lt;coding&gt;
                &lt;system value="http://terminology.hl7.org/CodeSystem/v2-0001"/&gt;
                &lt;code value="A"/&gt;
                &lt;display value="Ambiguous"/&gt;
              &lt;/coding&gt;
            &lt;/valueCodeableConcept&gt;
          &lt;/extension&gt;
        &lt;/gender&gt;
        &lt;managingOrganization&gt;
          &lt;reference value="Organization/1"/&gt;
          &lt;display value="ACME Healthcare, Inc"/&gt;
        &lt;/managingOrganization&gt;
      &lt;/Patient&gt;
    &lt;/resource&gt;
  &lt;/entry&gt;
&lt;/Bundle&gt;
</pre>
<hr/>
<p><p>Response: Response - since this is asynchronous, the response is empty</p>
</p>
<pre>

200 OK
[other headers]
</pre>
<p><p>Response: Response - if the message couldn't be accepted (e.g. there'll be no asynchronous response</p>
</p>
<pre>

500 OK Internal Server Error
[other headers]

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;OperationOutcome xmlns="http://hl7.org/fhir"&gt;
  &lt;id value="exception"/&gt;
  &lt;text&gt;
    &lt;status value="generated"/&gt;
    &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
      &lt;p&gt;SQL Link Communication Error (dbx = 34234)&lt;/p&gt;
    &lt;/div&gt;
  &lt;/text&gt;
  &lt;issue&gt;
    &lt;severity value="error"/&gt;
    &lt;code value="exception"/&gt;
    &lt;details&gt;
      &lt;text value="SQL Link Communication Error (dbx = 34234)"/&gt;
    &lt;/details&gt;
  &lt;/issue&gt;
&lt;/OperationOutcome&gt;
</pre>
<p>&nbsp;</p>

<p>
For more information about operations, including how they are invoked, see <a href="operations.html">Operations</a>.
</p>

</div>


				</div>  <!-- /inner-wrapper -->
            </div>  <!-- /row -->
        </div>  <!-- /container -->
        
    </div>  <!-- /segment-content -->


        <div id="segment-footer" class="segment"></div>  <!-- /segment-footer -->
  <!-- disqus thread -->
  <!-- disqus -->
  <!-- end disqus -->        
	
	<div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
		<div class="container">  <!-- container -->
		</div>  <!-- /container -->
	</div>  <!-- /segment-post-footer -->
    
      <!-- JS and analytics only. -->
      <!-- Bootstrap core JavaScript
================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
<script src="./assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
<script src="./dist/js/bootstrap.min.js"> </script>
<script src="./assets/js/respond.min.js"> </script>

<script src="./assets/js/fhir.js"> </script>

  <!-- Analytics Below
================================================== -->
        <script src="./assets/js/template-web.js"></script>
        <script src="./assets/js/nav.js"></script>
        <script>
            var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?351f802705b09ff497ed83d498777ee1";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    
</body>
</html>